<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="cart.css">
</head>
<body>
    
    <header>
        <div class="logo">G</div>
        <nav>
            <ul>
                <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li><a href="index.html#recommended">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</a></li>
                <li><a href="index.html#new-releases">–ù–æ–≤–∏–Ω–∫–∏</a></li>
                <li><a href="index.html#sales">–°–∫–∏–¥–∫–∏</a></li>
            </ul>
        </nav>
        <div class="icons">
            <div id="cart-container" onclick="window.location.href='cart.html'">üõí</div>
        </div>
    </header>
    
    <main>
        
        <div id="cart-items"></div>
        <div class="checkout-form">
            <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <form id="checkout-form">
                <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required>
                <input type="text" id="email" placeholder="–í–∞—à email" required>
                <button type="submit">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </form>
        </div>
        
        
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>–û –Ω–∞—Å</h3>
                <p>–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏.</p>
            </div>
            <div class="footer-section">
                <h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
                <ul>
                    <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="index.html#categories">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="index.html#recommended">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ</a></li>
                    <li><a href="index.html#new-releases">–ù–æ–≤–∏–Ω–∫–∏</a></li>
                    <li><a href="index.html#sales">–°–∫–∏–¥–∫–∏</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                <p>–¢–µ–ª–µ—Ñ–æ–Ω: +7 123 456 7890</p>
                <p>Email: support@example.com</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2024 –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∏–≥—Ä. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('checkout-form').addEventListener('submit', handleCheckout);
    console.log(localStorage);
});

async function handleCheckout(event) {
    event.preventDefault();
    
    const email = document.getElementById('email').value;
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    

    const response = await fetch('/api/order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, cart })
    });

    if (response.ok) {
        alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! –ö–ª—é—á–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à email.');
        localStorage.clear();
        window.location.href = 'index.html'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
    } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    }
}

async function updateCartUI() {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let totalQuantity = cart.reduce((total, item) => total + item.quantity, 0);
    let totalPrice = cart.reduce((total, item) => total + (item.price * item.quantity), 0);

    const cartIcon = document.getElementById('cart-container');
    cartIcon.textContent = `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${totalQuantity} —à—Ç. - ${totalPrice} —Ä—É–±.)`;

    const cartContainer = document.getElementById('cart-items');
    cartContainer.innerHTML = '';
    cart.forEach((item, index) => {
        const itemElement = document.createElement('div');
        itemElement.className = 'cart-item';
        itemElement.innerHTML = `
            <img src="${item.imageurl}" alt="${item.title}" style="width:100px; height:100px; object-fit: cover;">
            <div>–ù–∞–∑–≤–∞–Ω–∏–µ: ${item.title}</div>
            <p>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É: ${item.price} —Ä—É–±.</p>
            <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:<input type="number" min="1" value="${item.quantity}" onchange="updateItemQuantity(${index}, this.value)"></div>
            <button onclick="removeFromCart(${index})">–£–¥–∞–ª–∏—Ç—å</button>
        `;
        cartContainer.appendChild(itemElement);
    });
}

function updateItemQuantity(index, quantity) {
    let cart = JSON.parse(localStorage.getItem('cart'));
    if (quantity >= 1) {
        cart[index].quantity = parseInt(quantity);
    } else {
        cart[index].quantity = 1; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º—É–º 1, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartUI();
}

function removeFromCart(index) {
    let cart = JSON.parse(localStorage.getItem('cart'));
    cart.splice(index, 1); // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    localStorage.setItem('cart', JSON.stringify(cart));
    
    updateCartUI(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
}

document.addEventListener('DOMContentLoaded', function() {
    updateCartUI();
});

    </script>
    
</body>
</html>